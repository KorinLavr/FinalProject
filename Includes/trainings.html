<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>אימונים שלי</title>
    <link rel="stylesheet" href="../CSS/trainings.css">
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetch('fetch_trainings.php')
                .then(response => response.json())
                .then(data => {
                    console.log('Fetched data:', data);
                    const container = document.getElementById('trainingsContainer');
                    data.forEach(training => {
                        const session = document.createElement('div');
                        session.classList.add('training-session');
                        session.innerHTML = `
                            <div class="field"><span class="label">תז מאמן:</span><span class="value">${training.Trainer_ID}</span></div>
                            <div class="field"><span class="label">סוג האימון:</span><span class="value">${training.Type}</span></div>
                            <div class="field"><span class="label">מיקום:</span><span class="value">${training.Place}</span></div>
                            <div class="field"><span class="label">תאריך האימון:</span><span class="value">${training.Train_date}</span></div>
                            <div class="field"><span class="label">שעת האימון:</span><span class="value">${training.Time}</span></div>
                            <div class="field"><span class="label">מחיר האימון:</span><span class="value">${training.Cost}</span></div>
                            <div class="field"><span class="label">מקסימום משתתפים:</span><span class="value">${training.Max_training}</span></div>
                            <div class="field"><span class="label">תיאור האימון:</span><span class="value">${training.Descript}</span></div>
                            <div class="field actions"><button class="edit-button" onclick="editTraining(this)">ערוך פרטי אימון</button></div>
                        `;
                        container.appendChild(session);
                    });
                })
                .catch(error => console.error('Error fetching training data:', error));
        });

        function editTraining(button) {
            const session = button.closest('.training-session');
            const fields = session.querySelectorAll('.field .value');
            fields.forEach((field, index) => {
                const input = document.createElement('input');
                input.type = 'text';
                input.value = field.textContent;
                field.innerHTML = '';
                field.appendChild(input);
            });
            button.textContent = 'שמור';
            button.classList.add('save-button');
            button.onclick = function() {
                saveTraining(button);
            };
        }

        function saveTraining(button) {
            const session = button.closest('.training-session');
            const inputs = session.querySelectorAll('.field .value input');
            const training = {
                Trainer_ID: session.querySelector('.field:nth-child(1) .value').textContent,
                Type: inputs[0].value,
                Place: inputs[1].value,
                Train_date: inputs[2].value,
                Time: inputs[3].value,
                Cost: inputs[4].value,
                Max_training: inputs[5].value,
                Descript: inputs[6].value
            };

            fetch('update_training.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(training)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    inputs.forEach((input, index) => {
                        const valueSpan = input.closest('.value');
                        valueSpan.textContent = input.value;
                    });
                    button.textContent = 'ערוך פרטי אימון';
                    button.classList.remove('save-button');
                    button.onclick = function() {
                        editTraining(button);
                    };
                } else {
                    console.error('Error saving training:', data.error);
                    alert('Failed to save training: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while saving the training');
            });
        }
    </script>
</head>
<body>
    <div class="training-container">
        <h1>אימונים שלי</h1>
        <div id="trainingsContainer">
            <!-- Training data will be inserted here by JavaScript -->
        </div>
        <div class="button-container">
            <button class="profile-button" onclick="window.location.href='profile_trainer.php'">
                חזרה לפרופיל מאמן
            </button>
        </div>
    </div>
</body>
</html>
